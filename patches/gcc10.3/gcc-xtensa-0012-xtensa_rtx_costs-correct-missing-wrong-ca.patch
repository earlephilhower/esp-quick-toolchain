From 09850499adbc5f1ee24a12bfc51fa5126f7b3840 Mon Sep 17 00:00:00 2001
From: Takayuki 'January June' Suwa <jjsuwa_sys3175@yahoo.co.jp>
Date: Sat, 1 May 2021 15:49:53 +0900
Subject: [PATCH 08/13] GCC: xtensa (xtensa_rtx_costs): correct missing/wrong
 cases for ffs/ctz/clz/bswap

---
 gcc/config/xtensa/xtensa.c | 11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

diff --git a/gcc/config/xtensa/xtensa.c b/gcc/config/xtensa/xtensa.c
index 15e28f3a9..ec7c40e1f 100644
--- a/gcc/config/xtensa/xtensa.c
+++ b/gcc/config/xtensa/xtensa.c
@@ -3917,11 +3917,18 @@ xtensa_rtx_costs (rtx x, machine_mode mode, int outer_code,
 
     case FFS:
     case CTZ:
-      *total = COSTS_N_INSNS (TARGET_NSA ? 5 : 50);
+      *total = COSTS_N_INSNS ((TARGET_NSA && mode != DImode) ? 5 : 50);
       return true;
 
     case CLZ:
-      *total = COSTS_N_INSNS (TARGET_NSA ? 1 : 50);
+      *total = COSTS_N_INSNS ((TARGET_NSA && mode != DImode) ? 1 : 50);
+      return true;
+
+    case BSWAP:
+      if (mode == DImode)
+	*total = COSTS_N_INSNS (optimize > 1 && !optimize_size ? 9 : 50);
+      else
+	*total = COSTS_N_INSNS (5);
       return true;
 
     case NOT:
-- 
2.20.1

